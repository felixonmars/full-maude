  ---- from the book All About Maude
  ---- from the Maude Manual
  ---- by the Maude team + Santiago Escobar

mod NARROWING-VM-NOTOP is 
    sorts Coin Item Marking Money State . 
    subsort Coin < Money .
    op empty : -> Money .
    op __ : Money Money -> Money [assoc comm id: empty] . 
    subsort Money Item < Marking . 
    op __ : Marking Marking -> Marking [assoc comm id: empty] . 
    subsort Marking < State .
    ops $ q : -> Coin . ops a c : -> Item . 
    var M : Marking .
    rl [buy-c] : $ => c . 
    rl [buy-a] : $ => a q . 
    eq [change]: q q q q = $ [variant] . 
endm

mod NARROWING-VM-NOTOP-COHERENT is
    sorts Coin Item Marking Money State . 
    subsort Coin < Money .
    op empty : -> Money .
    op __ : Money Money -> Money [assoc comm id: empty] .
    subsort Money Item < Marking .
    op __ : Marking Marking -> Marking [assoc comm id: empty] .
    subsort Marking < State .
    ops $ q : -> Coin . ops a c : -> Item . var M : Marking .
    rl [buy-c] : M $ => M c .
    rl [buy-a] : M $ => M a q .
    eq [change]: q q q q M = $ M [variant] .
endm

red in FULL-MAUDE :
            metaParamodulationSearch(
              upModule('NARROWING-VM-NOTOP-COHERENT, false),
              'M:Money,
              '__['a.Item, 'c.Item],
              none, '*, unbounded, 1, unbounded) .
---(
result ResultTriple: {'__['a.Item,'c.Item,'empty.Money],'Marking,
	'#1:`[State`] <- '__['q.Coin,'q.Coin,'q.Coin,'empty.Money] ; 
	'#4:`[State`] <- '__['a.Item,'empty.Money] ; 
	'#6:Money <- 'empty.Money ; 
	'%3:Money <- '__['q.Coin,'q.Coin,'q.Coin,'empty.Money] ; 
	'M:Money <- '__['a.Item,'q.Coin,'__['q.Coin,'q.Coin,'q.Coin,'empty.Money]]}
---)

red in FULL-MAUDE :
            metaParamodulationSearch(
              axCohComplete(upModule('NARROWING-VM-NOTOP, false)),
              'M:Money,
              '__['a.Item, 'c.Item],
              none, '*, unbounded, 1, unbounded) .
---(
result ResultTriple: {'__['a.Item,'c.Item,'empty.Money],'Marking,
	'#1:`[State`] <- '__['q.Coin,'q.Coin,'q.Coin,'empty.Money] ; 
	'#4:`[State`] <- '__['a.Item,'empty.Money] ; 
	'#6:Money <- 'empty.Money ; 
	'%3:Money <- '__['q.Coin,'q.Coin,'q.Coin,'empty.Money] ; 
	'M:Money <- '__['c.Item,'__['q.Coin,'q.Coin,'q.Coin,'empty.Money]]}
---)

red in FULL-MAUDE : axCohComplete(upModule('NARROWING-VM-NOTOP, false)) .
---(
result SModule: mod 'NARROWING-VM-NOTOP is
  including 'BOOL .
  sorts 'Coin ; 'Item ; 'Marking ; 'Money ; 'State .
  subsort 'Coin < 'Money .
  subsort 'Item < 'Marking .
  subsort 'Marking < 'State .
  subsort 'Money < 'Marking .
  op '$ : nil -> 'Coin [none] .
  op '__ : 'Marking 'Marking -> 'Marking [assoc comm id('empty.Money)] .
  op '__ : 'Money 'Money -> 'Money [assoc comm id('empty.Money)] .
  op 'a : nil -> 'Item [none] .
  op 'c : nil -> 'Item [none] .
  op 'empty : nil -> 'Money [none] .
  op 'q : nil -> 'Coin [none] .
  none
  eq '__['q.Coin,'q.Coin,'q.Coin,'q.Coin,'X@@@:`[State`]] = '__['$.Coin,'X@@@:`[State`]] [variant
    label('change)] .
  rl '__['$.Coin,'X@@@:`[State`]] => '__['c.Item,'X@@@:`[State`]] [label('buy-c)] .
  rl '__['$.Coin,'X@@@:`[State`]] => '__['a.Item,'q.Coin,'X@@@:`[State`]] [label('buy-a)] .
endm
---)

red "--------------------------------------------------------------------------" .

red in FULL-MAUDE :
            upModule('NARROWING-VM-NOTOP-COHERENT, false) .
---(
result SModule: mod 'NARROWING-VM-NOTOP-COHERENT is
  including 'BOOL .
  sorts 'Coin ; 'Item ; 'Marking ; 'Money ; 'State .
  subsort 'Coin < 'Money .
  subsort 'Item < 'Marking .
  subsort 'Marking < 'State .
  subsort 'Money < 'Marking .
  op '$ : nil -> 'Coin [none] .
  op '__ : 'Marking 'Marking -> 'Marking [assoc comm id('empty.Money)] .
  op '__ : 'Money 'Money -> 'Money [assoc comm id('empty.Money)] .
  op 'a : nil -> 'Item [none] .
  op 'c : nil -> 'Item [none] .
  op 'empty : nil -> 'Money [none] .
  op 'q : nil -> 'Coin [none] .
  none
  eq '__['q.Coin,'q.Coin,'q.Coin,'q.Coin,'M:Marking] = '__['$.Coin,'M:Marking]
    [variant label('change)] .
  rl '__['$.Coin,'M:Marking] => '__['M:Marking,'__['q.Coin,'a.Item]] [label(
    'buy-a)] .
  rl '__['$.Coin,'M:Marking] => '__['c.Item,'M:Marking] [label('buy-c)] .
endm
---)

red in FULL-MAUDE :
            axCohComplete(upModule('NARROWING-VM-NOTOP, false)) .
---(
result SModule: mod 'NARROWING-VM-NOTOP is
  including 'BOOL .
  sorts 'Coin ; 'Item ; 'Marking ; 'Money ; 'State .
  subsort 'Coin < 'Money .
  subsort 'Item < 'Marking .
  subsort 'Marking < 'State .
  subsort 'Money < 'Marking .
  op '$ : nil -> 'Coin [none] .
  op '__ : 'Marking 'Marking -> 'Marking [assoc comm id('empty.Money)] .
  op '__ : 'Money 'Money -> 'Money [assoc comm id('empty.Money)] .
  op 'a : nil -> 'Item [none] .
  op 'c : nil -> 'Item [none] .
  op 'empty : nil -> 'Money [none] .
  op 'q : nil -> 'Coin [none] .
  none
  eq '__['q.Coin,'q.Coin,'q.Coin,'q.Coin,'X@@@:`[State`]] = '__['$.Coin,
    'X@@@:`[State`]] [variant label('change)] .
  rl '__['$.Coin,'X@@@:`[State`]] => '__['c.Item,'X@@@:`[State`]] [label(
    'buy-c)] .
  rl '__['$.Coin,'X@@@:`[State`]] => '__['a.Item,'q.Coin,'X@@@:`[State`]] [
    label('buy-a)] .
endm
---)

red in FULL-MAUDE :
            metaParamodulationSearch(
mod 'NARROWING-VM-NOTOP is
  including 'BOOL .
  sorts 'Coin ; 'Item ; 'Marking ; 'Money ; 'State .
  subsort 'Coin < 'Money .
  subsort 'Item < 'Marking .
  subsort 'Marking < 'State .
  subsort 'Money < 'Marking .
  op '$ : nil -> 'Coin [none] .
  op '__ : 'Marking 'Marking -> 'Marking [assoc comm id('empty.Money)] .
  op '__ : 'Money 'Money -> 'Money [assoc comm id('empty.Money)] .
  op 'a : nil -> 'Item [none] .
  op 'c : nil -> 'Item [none] .
  op 'empty : nil -> 'Money [none] .
  op 'q : nil -> 'Coin [none] .
  none
  eq '__['q.Coin,'q.Coin,'q.Coin,'q.Coin,'X@@@:State] = '__['$.Coin,
    'X@@@:State] [variant label('change)] .
  rl '__['$.Coin,'X@@@:State] => '__['c.Item,'X@@@:State] [label(
    'buy-c)] .
  rl '__['$.Coin,'X@@@:State] => '__['a.Item,'q.Coin,'X@@@:State] [
    label('buy-a)] .
endm
,
              'M:Money,
              '__['a.Item, 'c.Item],
              none, '*, unbounded, 1, unbounded) .

red in FULL-MAUDE :
            metaParamodulationSearch(
mod 'NARROWING-VM-NOTOP is
  including 'BOOL .
  sorts 'Coin ; 'Item ; 'Marking ; 'Money ; 'State .
  subsort 'Coin < 'Money .
  subsort 'Item < 'Marking .
  subsort 'Marking < 'State .
  subsort 'Money < 'Marking .
  op '$ : nil -> 'Coin [none] .
  op '__ : 'Marking 'Marking -> 'Marking [assoc comm id('empty.Money)] .
  op '__ : 'Money 'Money -> 'Money [assoc comm id('empty.Money)] .
  op 'a : nil -> 'Item [none] .
  op 'c : nil -> 'Item [none] .
  op 'empty : nil -> 'Money [none] .
  op 'q : nil -> 'Coin [none] .
  none
  eq '__['q.Coin,'q.Coin,'q.Coin,'q.Coin,'X@@@:`[State`]] = '__['$.Coin,
    'X@@@:`[State`]] [variant label('change)] .
  rl '__['$.Coin,'X@@@:`[State`]] => '__['a.Item,'q.Coin,'X@@@:`[State`]] [
    label('buy-a)] .
  rl '__['$.Coin,'X@@@:`[State`]] => '__['c.Item,'X@@@:`[State`]] [label(
    'buy-c)] .
endm
,
              'M:Money,
              '__['a.Item, 'c.Item],
              none, '*, unbounded, 2, unbounded) .
